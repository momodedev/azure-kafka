---
- name: Deploy Prometheus and Grafana to monitoring host
  hosts: all
  become: true
  vars:
    broker_ips: "{{ (broker_ips | default('')) | split(',') | reject('equalto', '') | list }}"
    prometheus_version: "2.52.0"
  vars_files:
    - vars
  roles:
    - monitoring

- name: Reload Prometheus configuration
  hosts: mgmt-kafka-monitor
  tasks:
    - name: Reload Prometheus service
      systemd:
        name: prometheus
        state: restarted
      notify: Wait for Prometheus to be ready

    - name: Wait for Prometheus to be ready
      wait_for:
        port: 9090
        delay: 2
        timeout: 30
